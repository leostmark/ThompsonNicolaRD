<Activity mc:Ignorable="sap" x:Class="{x:Null}" sap:VirtualizedContainerService.HintSize="1404,2297" mva:VisualBasic.Settings="Assembly references and imported namespaces serialized as XML namespaces" xmlns="http://schemas.microsoft.com/netfx/2009/xaml/activities" xmlns:av="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:eacg="clr-namespace:ESRI.ArcGIS.Client.Geometry;assembly=ESRI.ArcGIS.Client" xmlns:eact="clr-namespace:ESRI.ArcGIS.Client.Tasks;assembly=ESRI.ArcGIS.Client" xmlns:esri="http://schemas.esri.com/arcgis/client/2009" xmlns:ggg="clr-namespace:Geocortex.Gis.Geometries;assembly=Geocortex.Gis" xmlns:gpctwa="clr-namespace:Geocortex.Projects.CoLG.Tempest.Workflows.Activities;assembly=Geocortex.Projects.CoLG.Tempest.Workflows" xmlns:gpctwd="clr-namespace:Geocortex.Projects.CoLG.Tempest.Workflows.Data;assembly=Geocortex.Projects.CoLG.Tempest.Workflows" xmlns:gwa="clr-namespace:Geocortex.Workflow.Activities;assembly=Geocortex.Workflow.Activities" xmlns:gwa1="clr-namespace:Geocortex.Workflow.Activities;assembly=Geocortex.Workflow" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mva="clr-namespace:Microsoft.VisualBasic.Activities;assembly=System.Activities" xmlns:s="clr-namespace:System;assembly=System" xmlns:s1="clr-namespace:System;assembly=mscorlib" xmlns:s2="clr-namespace:System;assembly=System.Core" xmlns:s3="clr-namespace:System;assembly=System.ServiceModel" xmlns:s4="clr-namespace:System;assembly=System.Numerics" xmlns:s5="clr-namespace:System;assembly=System.Web.Services" xmlns:s6="clr-namespace:System;assembly=System.AddIn" xmlns:s7="clr-namespace:System;assembly=System.Design" xmlns:s8="clr-namespace:System;assembly=System.Drawing.Design" xmlns:sa="clr-namespace:System.Activities;assembly=System.Activities" xmlns:sap="http://schemas.microsoft.com/netfx/2009/xaml/activities/presentation" xmlns:scg="clr-namespace:System.Collections.Generic;assembly=System.Core" xmlns:scg1="clr-namespace:System.Collections.Generic;assembly=System" xmlns:scg2="clr-namespace:System.Collections.Generic;assembly=mscorlib" xmlns:scg3="clr-namespace:System.Collections.Generic;assembly=System.ServiceModel" xmlns:scs="clr-namespace:System.Collections.Specialized;assembly=System" xmlns:sd="clr-namespace:System.Data;assembly=System.Data" xmlns:st="clr-namespace:System.Text;assembly=mscorlib" xmlns:sxs="clr-namespace:System.Xml.Serialization;assembly=System.Xml" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Sequence sap:VirtualizedContainerService.HintSize="1364,2257" mva:VisualBasic.Settings="Assembly references and imported namespaces serialized as XML namespaces">
    <Sequence.Variables>
      <Variable x:TypeArguments="x:String" Name="tempestSessionId" />
      <Variable x:TypeArguments="scg2:Dictionary(x:String, scg2:List(x:String))" Name="tempestResults" />
      <Variable x:TypeArguments="scg2:Dictionary(x:String, x:String)" Default="[New Dictionary (Of String, String)]" Name="tempestMappings" />
      <Variable x:TypeArguments="gpctwd:TempestSession" Name="tempestSession" />
      <Variable x:TypeArguments="x:String" Name="initializationErrorMessage" />
      <Variable x:TypeArguments="esri:Envelope" Name="zoomEnvelope" />
    </Sequence.Variables>
    <sap:WorkflowViewStateService.ViewState>
      <scg2:Dictionary x:TypeArguments="x:String, x:Object">
        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
      </scg2:Dictionary>
    </sap:WorkflowViewStateService.ViewState>
    <gpctwa:TempestStartActivity DisplayName="Get Tempest Session ID" ExternalId="TempestStartActivity" sap:VirtualizedContainerService.HintSize="1342,22" TempestSessionID="[tempestSessionId]" />
    <If Condition="[String.IsNullOrEmpty(tempestSessionId)]" sap:VirtualizedContainerService.HintSize="1342,2071">
      <If.Then>
        <gwa:ServerPlaceHolder Description="If no Tempest session id, then the map has been launched independent of Tempest and nothing needs to be done." sap:VirtualizedContainerService.HintSize="314,1970" />
      </If.Then>
      <If.Else>
        <Sequence sap:VirtualizedContainerService.HintSize="1003,1970">
          <sap:WorkflowViewStateService.ViewState>
            <scg2:Dictionary x:TypeArguments="x:String, x:Object">
              <x:Boolean x:Key="IsExpanded">True</x:Boolean>
            </scg2:Dictionary>
          </sap:WorkflowViewStateService.ViewState>
          <gpctwa:CreateTempestSessionActivity ErrorMessage="{x:Null}" SiteName="{x:Null}" DatabaseConnectionStringName="TempestConnectionString" DbExportFields="" DbZoomFields="" DeleteSessionDetailsSql="DELETE FROM WC_SESSION_DETAILS WHERE SESSION_ID = {0}SessionId AND GIS_LAYER_NAME = {1}GIS_LAYER_NAME" DisplayName="Create Tempest Session" GisExportFields="" GisZoomFields="PROPERTY=PropertyTaxId" sap:VirtualizedContainerService.HintSize="981,22" InsertSessionDetailsSql="INSERT INTO WC_SESSION_DETAILS (SESSION_DETAIL_ID, SESSION_ID, SEARCH_LAYER_ID, LEGAL_ID, GISLINK, GIS_LAYER_ID, GIS_LAYER_NAME, DATE_STAMP, USER_STAMP) SELECT {1}, '{2}', WC_SEARCH_LAYERS.SEARCH_LAYER_ID, LAND_LEGAL.LEGAL_ID, LAND_LEGAL.GISLINK, LAND_LEGAL.GIS_LAYER_ID, WC_GIS_LAYERS.GIS_LAYER_NAME, {3}, 'ESSENTIALS' FROM LAND_LEGAL, WC_GIS_LAYERS, WC_SEARCH_LAYERS WHERE LAND_LEGAL.{4} = {0}UniqueId AND WC_GIS_LAYERS.GIS_LAYER_NAME = {0}LayerName AND WC_GIS_LAYERS.SEARCH_LAYER_ID = WC_SEARCH_LAYERS.SEARCH_LAYER_ID" LayerNameMappings="PROPERTY=Parcel" ProviderName="System.Data.SqlClient" SelectMapLayersSql="SELECT DISTINCT (GIS_LAYER_NAME) FROM WC_GIS_LAYERS" SelectSessionDetailsSql="SELECT L.{1} FROM WC_SESSION_DETAILS W, LAND_LEGAL L WHERE W.SESSION_ID = {0}SessionId AND W.LEGAL_ID = L.LEGAL_ID AND W.GIS_LAYER_NAME = {0}LayerName" TempestSession="[tempestSession]" TempestSessionId="[tempestSessionId]" ZoomBuffer="0" />
          <Flowchart sap:VirtualizedContainerService.HintSize="981,49">
            <sap:WorkflowViewStateService.ViewState>
              <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                <x:Boolean x:Key="IsExpanded">False</x:Boolean>
                <av:Point x:Key="ShapeLocation">270,2.5</av:Point>
                <av:Size x:Key="ShapeSize">60,75</av:Size>
                <av:PointCollection x:Key="ConnectorLocation">300,77.5 300,107.5 300,122.5</av:PointCollection>
                <x:Double x:Key="Width">627.83109982808446</x:Double>
                <x:Double x:Key="Height">811.17000000000007</x:Double>
              </scg2:Dictionary>
            </sap:WorkflowViewStateService.ViewState>
            <Flowchart.StartNode>
              <FlowDecision x:Name="__ReferenceID4" Condition="[tempestSession.GisZoomFields IsNot Nothing]" sap:VirtualizedContainerService.HintSize="60,75">
                <sap:WorkflowViewStateService.ViewState>
                  <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                    <av:Point x:Key="ShapeLocation">270,122.5</av:Point>
                    <av:Size x:Key="ShapeSize">60,75</av:Size>
                    <av:PointCollection x:Key="TrueConnector">270,160 240,160 200,160</av:PointCollection>
                    <av:PointCollection x:Key="FalseConnector">330,160 345,160 345,232.5 315,232.5 315,262.5</av:PointCollection>
                  </scg2:Dictionary>
                </sap:WorkflowViewStateService.ViewState>
                <FlowDecision.True>
                  <FlowStep x:Name="__ReferenceID5">
                    <sap:WorkflowViewStateService.ViewState>
                      <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                        <av:Point x:Key="ShapeLocation">0,149</av:Point>
                        <av:Size x:Key="ShapeSize">200,22</av:Size>
                        <av:PointCollection x:Key="ConnectorLocation">100,171 100,230.723333333333 285,230.723333333333 285,262.5</av:PointCollection>
                      </scg2:Dictionary>
                    </sap:WorkflowViewStateService.ViewState>
                    <AddToCollection x:TypeArguments="scg2:KeyValuePair(x:String, x:String)" Collection="[tempestMappings]" DisplayName="GisZoomFields" sap:VirtualizedContainerService.HintSize="200,22" Item="[New KeyValuePair(Of String, String)(&quot;GisZoomFields&quot;, tempestSession.GisZoomFields.ToString)]" />
                    <FlowStep.Next>
                      <FlowDecision x:Name="__ReferenceID3" Condition="[tempestSession.DbZoomFields IsNot Nothing]" sap:VirtualizedContainerService.HintSize="60,75">
                        <sap:WorkflowViewStateService.ViewState>
                          <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                            <av:Point x:Key="ShapeLocation">270,262.5</av:Point>
                            <av:Size x:Key="ShapeSize">60,75</av:Size>
                            <av:PointCollection x:Key="TrueConnector">270,300 240,300 200,300</av:PointCollection>
                            <av:PointCollection x:Key="FalseConnector">330,300 345,300 345,372.5 315,372.5 315,402.5</av:PointCollection>
                          </scg2:Dictionary>
                        </sap:WorkflowViewStateService.ViewState>
                        <FlowDecision.True>
                          <FlowStep x:Name="__ReferenceID6">
                            <sap:WorkflowViewStateService.ViewState>
                              <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                <av:Point x:Key="ShapeLocation">0,289</av:Point>
                                <av:Size x:Key="ShapeSize">200,22</av:Size>
                                <av:PointCollection x:Key="ConnectorLocation">100,311 100,373.446666666667 285,373.446666666667 285,402.5</av:PointCollection>
                              </scg2:Dictionary>
                            </sap:WorkflowViewStateService.ViewState>
                            <AddToCollection x:TypeArguments="scg2:KeyValuePair(x:String, x:String)" Collection="[tempestMappings]" DisplayName="DbZoomFields" sap:VirtualizedContainerService.HintSize="200,22" Item="[New KeyValuePair(Of String, String)(&quot;DbZoomFields&quot;, tempestSession.DbZoomFields.ToString)]" />
                            <FlowStep.Next>
                              <FlowDecision x:Name="__ReferenceID2" Condition="[tempestSession.GisExportFields IsNot Nothing]" sap:VirtualizedContainerService.HintSize="60,75">
                                <sap:WorkflowViewStateService.ViewState>
                                  <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                    <av:Point x:Key="ShapeLocation">270,402.5</av:Point>
                                    <av:Size x:Key="ShapeSize">60,75</av:Size>
                                    <av:PointCollection x:Key="TrueConnector">270,440 240,440 210,440</av:PointCollection>
                                    <av:PointCollection x:Key="FalseConnector">330,440 345,440 345,502.5 315,502.5 315,532.5</av:PointCollection>
                                  </scg2:Dictionary>
                                </sap:WorkflowViewStateService.ViewState>
                                <FlowDecision.True>
                                  <FlowStep x:Name="__ReferenceID7">
                                    <sap:WorkflowViewStateService.ViewState>
                                      <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                        <av:Point x:Key="ShapeLocation">10,429</av:Point>
                                        <av:Size x:Key="ShapeSize">200,22</av:Size>
                                        <av:PointCollection x:Key="ConnectorLocation">110,451 110,504.446666666667 285,504.446666666667 285,532.5</av:PointCollection>
                                      </scg2:Dictionary>
                                    </sap:WorkflowViewStateService.ViewState>
                                    <AddToCollection x:TypeArguments="scg2:KeyValuePair(x:String, x:String)" Collection="[tempestMappings]" DisplayName="GisExportFields" sap:VirtualizedContainerService.HintSize="200,22" Item="[New KeyValuePair(Of String, String)(&quot;GisExportFields&quot;, tempestSession.GisExportFields.ToString)]" />
                                    <FlowStep.Next>
                                      <FlowDecision x:Name="__ReferenceID1" Condition="[tempestSession.DbExportFields IsNot Nothing]" sap:VirtualizedContainerService.HintSize="60,75">
                                        <sap:WorkflowViewStateService.ViewState>
                                          <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                            <av:Point x:Key="ShapeLocation">270,532.5</av:Point>
                                            <av:Size x:Key="ShapeSize">60,75</av:Size>
                                            <av:PointCollection x:Key="TrueConnector">270,570 240,570 200,570</av:PointCollection>
                                            <av:PointCollection x:Key="FalseConnector">330,570 345,570 345,622.5 315,622.5 315,652.5</av:PointCollection>
                                          </scg2:Dictionary>
                                        </sap:WorkflowViewStateService.ViewState>
                                        <FlowDecision.True>
                                          <FlowStep x:Name="__ReferenceID8">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                                <av:Point x:Key="ShapeLocation">0,559</av:Point>
                                                <av:Size x:Key="ShapeSize">200,22</av:Size>
                                                <av:PointCollection x:Key="ConnectorLocation">100,581 100,627.446666666667 285,627.446666666667 285,652.5</av:PointCollection>
                                              </scg2:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <AddToCollection x:TypeArguments="scg2:KeyValuePair(x:String, x:String)" Collection="[tempestMappings]" DisplayName="DbExportFields" sap:VirtualizedContainerService.HintSize="200,22" Item="[New KeyValuePair(Of String, String)(&quot;DbExportFields&quot;, tempestSession.DbExportFields.ToString)]" />
                                            <FlowStep.Next>
                                              <FlowDecision x:Name="__ReferenceID0" Condition="[tempestSession.LayerNameMappings IsNot Nothing]" sap:VirtualizedContainerService.HintSize="60,75">
                                                <sap:WorkflowViewStateService.ViewState>
                                                  <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                                    <av:Point x:Key="ShapeLocation">270,652.5</av:Point>
                                                    <av:Size x:Key="ShapeSize">60,75</av:Size>
                                                    <av:PointCollection x:Key="TrueConnector">270,690 240,690 200,690</av:PointCollection>
                                                  </scg2:Dictionary>
                                                </sap:WorkflowViewStateService.ViewState>
                                                <FlowDecision.True>
                                                  <FlowStep x:Name="__ReferenceID9">
                                                    <sap:WorkflowViewStateService.ViewState>
                                                      <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                                        <av:Point x:Key="ShapeLocation">0,679</av:Point>
                                                        <av:Size x:Key="ShapeSize">200,22</av:Size>
                                                        <av:PointCollection x:Key="ConnectorLocation">110,591 110,637.446666666667 295,637.446666666667 295,662.5</av:PointCollection>
                                                      </scg2:Dictionary>
                                                    </sap:WorkflowViewStateService.ViewState>
                                                    <AddToCollection x:TypeArguments="scg2:KeyValuePair(x:String, x:String)" Collection="[tempestMappings]" DisplayName="LayerNameMappings" sap:VirtualizedContainerService.HintSize="200,22" Item="[New KeyValuePair(Of String, String)(&quot;LayerNameMappings&quot;, tempestSession.LayerNameMappings.ToString)]" />
                                                  </FlowStep>
                                                </FlowDecision.True>
                                              </FlowDecision>
                                            </FlowStep.Next>
                                          </FlowStep>
                                        </FlowDecision.True>
                                        <FlowDecision.False>
                                          <x:Reference>__ReferenceID0</x:Reference>
                                        </FlowDecision.False>
                                      </FlowDecision>
                                    </FlowStep.Next>
                                  </FlowStep>
                                </FlowDecision.True>
                                <FlowDecision.False>
                                  <x:Reference>__ReferenceID1</x:Reference>
                                </FlowDecision.False>
                              </FlowDecision>
                            </FlowStep.Next>
                          </FlowStep>
                        </FlowDecision.True>
                        <FlowDecision.False>
                          <x:Reference>__ReferenceID2</x:Reference>
                        </FlowDecision.False>
                      </FlowDecision>
                    </FlowStep.Next>
                  </FlowStep>
                </FlowDecision.True>
                <FlowDecision.False>
                  <x:Reference>__ReferenceID3</x:Reference>
                </FlowDecision.False>
              </FlowDecision>
            </Flowchart.StartNode>
            <x:Reference>__ReferenceID4</x:Reference>
            <x:Reference>__ReferenceID5</x:Reference>
            <x:Reference>__ReferenceID3</x:Reference>
            <x:Reference>__ReferenceID6</x:Reference>
            <x:Reference>__ReferenceID2</x:Reference>
            <x:Reference>__ReferenceID7</x:Reference>
            <x:Reference>__ReferenceID1</x:Reference>
            <x:Reference>__ReferenceID8</x:Reference>
            <x:Reference>__ReferenceID0</x:Reference>
            <x:Reference>__ReferenceID9</x:Reference>
          </Flowchart>
          <gpctwa:RetrieveTempestMappingsActivity DisplayName="Send Tempest Configuration" ExternalId="RetrieveTempestMappings" sap:VirtualizedContainerService.HintSize="981,22" TempestMappings="[tempestMappings]" />
          <InvokeMethod sap:VirtualizedContainerService.HintSize="981,127" MethodName="Initialize">
            <InvokeMethod.TargetObject>
              <InArgument x:TypeArguments="gpctwd:TempestSession">[tempestSession]</InArgument>
            </InvokeMethod.TargetObject>
          </InvokeMethod>
          <InvokeMethod sap:VirtualizedContainerService.HintSize="981,127" MethodName="GetTempestSelection">
            <InvokeMethod.Result>
              <OutArgument x:TypeArguments="scg2:Dictionary(x:String, scg2:List(x:String))">[tempestResults]</OutArgument>
            </InvokeMethod.Result>
            <InvokeMethod.TargetObject>
              <InArgument x:TypeArguments="gpctwd:TempestSession">[tempestSession]</InArgument>
            </InvokeMethod.TargetObject>
          </InvokeMethod>
          <ForEach x:TypeArguments="scg2:KeyValuePair(x:String, scg2:List(x:String))" DisplayName="ForEach&lt;KeyValuePair&lt;String,List&lt;String&gt;&gt;&gt;" sap:VirtualizedContainerService.HintSize="981,856" Values="[tempestResults]">
            <ActivityAction x:TypeArguments="scg2:KeyValuePair(x:String, scg2:List(x:String))">
              <ActivityAction.Argument>
                <DelegateInArgument x:TypeArguments="scg2:KeyValuePair(x:String, scg2:List(x:String))" Name="layer" />
              </ActivityAction.Argument>
              <If Condition="[layer.Value.Count &gt; 0]" sap:VirtualizedContainerService.HintSize="951,753">
                <If.Then>
                  <Flowchart sap:VirtualizedContainerService.HintSize="826,652">
                    <Flowchart.Variables>
                      <Variable x:TypeArguments="st:StringBuilder" Default="[New StringBuilder]" Name="queryValues" />
                      <Variable x:TypeArguments="esri:FeatureSet" Name="featureSet" />
                      <Variable x:TypeArguments="x:String" Name="layerId" />
                      <Variable x:TypeArguments="x:String" Name="mapserviceUrl" />
                      <Variable x:TypeArguments="esri:Envelope" Name="featuresEnvelope" />
                    </Flowchart.Variables>
                    <sap:WorkflowViewStateService.ViewState>
                      <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                        <x:Boolean x:Key="IsExpanded">False</x:Boolean>
                        <av:Point x:Key="ShapeLocation">270,2.5</av:Point>
                        <av:Size x:Key="ShapeSize">60,75</av:Size>
                        <av:PointCollection x:Key="ConnectorLocation">300,77.5 300,107.5 300,135.5</av:PointCollection>
                        <x:Double x:Key="Width">812.33109982808446</x:Double>
                        <x:Double x:Key="Height">616</x:Double>
                      </scg2:Dictionary>
                    </sap:WorkflowViewStateService.ViewState>
                    <Flowchart.StartNode>
                      <FlowStep x:Name="__ReferenceID10">
                        <sap:WorkflowViewStateService.ViewState>
                          <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                            <av:Point x:Key="ShapeLocation">200,135.5</av:Point>
                            <av:Size x:Key="ShapeSize">200,49</av:Size>
                            <av:PointCollection x:Key="ConnectorLocation">400,160 430,160 520,160</av:PointCollection>
                          </scg2:Dictionary>
                        </sap:WorkflowViewStateService.ViewState>
                        <ForEach x:TypeArguments="x:String" DisplayName="Create IN clause values" sap:VirtualizedContainerService.HintSize="200,49" Values="[layer.Value]">
                          <ActivityAction x:TypeArguments="x:String">
                            <ActivityAction.Argument>
                              <DelegateInArgument x:TypeArguments="x:String" Name="item" />
                            </ActivityAction.Argument>
                            <InvokeMethod sap:VirtualizedContainerService.HintSize="252,127" MethodName="Append">
                              <InvokeMethod.TargetObject>
                                <InArgument x:TypeArguments="st:StringBuilder">[queryValues]</InArgument>
                              </InvokeMethod.TargetObject>
                              <InArgument x:TypeArguments="x:String">[string.Format("'{0}',", item)]</InArgument>
                            </InvokeMethod>
                          </ActivityAction>
                        </ForEach>
                        <FlowStep.Next>
                          <FlowStep x:Name="__ReferenceID15">
                            <sap:WorkflowViewStateService.ViewState>
                              <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                <av:Point x:Key="ShapeLocation">520,135.5</av:Point>
                                <av:Size x:Key="ShapeSize">200,49</av:Size>
                                <av:PointCollection x:Key="ConnectorLocation">620,184.5 620,230 400,230</av:PointCollection>
                              </scg2:Dictionary>
                            </sap:WorkflowViewStateService.ViewState>
                            <gwa:GetMapServiceInfo sap:VirtualizedContainerService.HintSize="200,49" LayerId="[layerId]" LayerName="[layer.Key]" MapServiceId="0" MapServiceUrl="[mapserviceUrl]" />
                            <FlowStep.Next>
                              <FlowStep x:Name="__ReferenceID16">
                                <sap:WorkflowViewStateService.ViewState>
                                  <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                    <av:Point x:Key="ShapeLocation">200,205.5</av:Point>
                                    <av:Size x:Key="ShapeSize">200,49</av:Size>
                                    <av:PointCollection x:Key="ConnectorLocation">300,254.5 300,284.5 300,302.5</av:PointCollection>
                                  </scg2:Dictionary>
                                </sap:WorkflowViewStateService.ViewState>
                                <TryCatch sap:VirtualizedContainerService.HintSize="200,49">
                                  <TryCatch.Try>
                                    <Sequence sap:VirtualizedContainerService.HintSize="400,549">
                                      <sap:WorkflowViewStateService.ViewState>
                                        <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                          <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                        </scg2:Dictionary>
                                      </sap:WorkflowViewStateService.ViewState>
                                      <gwa:Log sap:VirtualizedContainerService.HintSize="330,59" LogLevel="Debug" Message="[mapserviceUrl + &quot;/&quot; + layerId + &quot;/query&quot;]" />
                                      <gwa:Log sap:VirtualizedContainerService.HintSize="330,59" LogLevel="Debug" Message="[&quot;PropertyTaxId IN (&quot; + queryValues.ToString.Trim(New Char(){&quot;,&quot;c}) + &quot;)&quot;]" />
                                      <gwa:QueryTask sap:VirtualizedContainerService.HintSize="330,227" OutFields="*" QueryServiceUrl="[mapserviceUrl + &quot;/&quot; + layerId + &quot;/query&quot;]" Results="[featureSet]" ReturnGeometry="True" SpatialRelationship="esriSpatialRelIntersects" Where="[&quot;PropertyTaxId IN (&quot; + queryValues.ToString.Trim(New Char(){&quot;,&quot;c}) + &quot;)&quot;]" />
                                    </Sequence>
                                  </TryCatch.Try>
                                  <TryCatch.Catches>
                                    <Catch x:TypeArguments="s1:Exception" sap:VirtualizedContainerService.HintSize="404,20">
                                      <sap:WorkflowViewStateService.ViewState>
                                        <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                          <x:Boolean x:Key="IsExpanded">False</x:Boolean>
                                          <x:Boolean x:Key="IsPinned">False</x:Boolean>
                                        </scg2:Dictionary>
                                      </sap:WorkflowViewStateService.ViewState>
                                      <ActivityAction x:TypeArguments="s1:Exception">
                                        <ActivityAction.Argument>
                                          <DelegateInArgument x:TypeArguments="s1:Exception" Name="exception" />
                                        </ActivityAction.Argument>
                                        <Sequence sap:VirtualizedContainerService.HintSize="398,621">
                                          <sap:WorkflowViewStateService.ViewState>
                                            <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                              <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                            </scg2:Dictionary>
                                          </sap:WorkflowViewStateService.ViewState>
                                          <ForEach x:TypeArguments="x:String" DisplayName="Create IN clause values" sap:VirtualizedContainerService.HintSize="330,230" Values="[layer.Value]">
                                            <ActivityAction x:TypeArguments="x:String">
                                              <ActivityAction.Argument>
                                                <DelegateInArgument x:TypeArguments="x:String" Name="item" />
                                              </ActivityAction.Argument>
                                              <InvokeMethod sap:VirtualizedContainerService.HintSize="252,127" MethodName="Append">
                                                <InvokeMethod.TargetObject>
                                                  <InArgument x:TypeArguments="st:StringBuilder">[queryValues]</InArgument>
                                                </InvokeMethod.TargetObject>
                                                <InArgument x:TypeArguments="x:String">["'" + item + "',"]</InArgument>
                                              </InvokeMethod>
                                            </ActivityAction>
                                          </ForEach>
                                          <gwa:QueryTask sap:VirtualizedContainerService.HintSize="330,227" OutFields="*" QueryServiceUrl="[mapserviceUrl + &quot;/&quot; + layerId + &quot;/query&quot;]" Results="[featureSet]" ReturnGeometry="True" SpatialRelationship="esriSpatialRelIntersects" Where="[&quot;OBJECTID IN (&quot; + queryValues.ToString.Trim(New Char(){&quot;,&quot;c}) + &quot;)&quot;]" />
                                        </Sequence>
                                      </ActivityAction>
                                    </Catch>
                                  </TryCatch.Catches>
                                </TryCatch>
                                <FlowStep.Next>
                                  <FlowDecision x:Name="__ReferenceID11" Condition="[featureSet IsNot Nothing]" sap:VirtualizedContainerService.HintSize="60,75">
                                    <sap:WorkflowViewStateService.ViewState>
                                      <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                        <av:Point x:Key="ShapeLocation">270,302.5</av:Point>
                                        <av:Size x:Key="ShapeSize">60,75</av:Size>
                                        <av:PointCollection x:Key="FalseConnector">330,340 360,340 390,340</av:PointCollection>
                                        <av:PointCollection x:Key="TrueConnector">270,340 240,340 200,340</av:PointCollection>
                                      </scg2:Dictionary>
                                    </sap:WorkflowViewStateService.ViewState>
                                    <FlowDecision.True>
                                      <FlowStep x:Name="__ReferenceID13">
                                        <sap:WorkflowViewStateService.ViewState>
                                          <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                            <av:Point x:Key="ShapeLocation">0,315.5</av:Point>
                                            <av:Size x:Key="ShapeSize">200,49</av:Size>
                                            <av:PointCollection x:Key="ConnectorLocation">100,364.5 100,394.5 100,399</av:PointCollection>
                                          </scg2:Dictionary>
                                        </sap:WorkflowViewStateService.ViewState>
                                        <gwa:SelectFeatures ClearCollectionFirst="False" FeatureSet="[featureSet]" sap:VirtualizedContainerService.HintSize="200,49" LayerId="[layerId]" MapServiceId="0" />
                                        <FlowStep.Next>
                                          <FlowStep x:Name="__ReferenceID14">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                                <av:Point x:Key="ShapeLocation">0,399</av:Point>
                                                <av:Size x:Key="ShapeSize">200,49</av:Size>
                                                <av:PointCollection x:Key="ConnectorLocation">100,448 100,478 100,499</av:PointCollection>
                                              </scg2:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <gwa:GetFeatureSetExtent FeatureSet="[featureSet]" sap:VirtualizedContainerService.HintSize="200,49" Result="[featuresEnvelope]" />
                                            <FlowStep.Next>
                                              <FlowStep x:Name="__ReferenceID17">
                                                <sap:WorkflowViewStateService.ViewState>
                                                  <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                                    <av:Point x:Key="ShapeLocation">0,499</av:Point>
                                                    <av:Size x:Key="ShapeSize">200,49</av:Size>
                                                  </scg2:Dictionary>
                                                </sap:WorkflowViewStateService.ViewState>
                                                <If Condition="[zoomEnvelope Is Nothing]" sap:VirtualizedContainerService.HintSize="200,49">
                                                  <If.Then>
                                                    <Sequence sap:VirtualizedContainerService.HintSize="264,280">
                                                      <sap:WorkflowViewStateService.ViewState>
                                                        <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                                          <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                        </scg2:Dictionary>
                                                      </sap:WorkflowViewStateService.ViewState>
                                                      <gwa:Log sap:VirtualizedContainerService.HintSize="242,59" LogLevel="Debug" Message="assigning featuresEnvelope to zoomEnvelope" />
                                                      <Assign sap:VirtualizedContainerService.HintSize="242,57">
                                                        <Assign.To>
                                                          <OutArgument x:TypeArguments="esri:Envelope">[zoomEnvelope]</OutArgument>
                                                        </Assign.To>
                                                        <Assign.Value>
                                                          <InArgument x:TypeArguments="esri:Envelope">[featuresEnvelope]</InArgument>
                                                        </Assign.Value>
                                                      </Assign>
                                                    </Sequence>
                                                  </If.Then>
                                                  <If.Else>
                                                    <Sequence sap:VirtualizedContainerService.HintSize="264,280">
                                                      <sap:WorkflowViewStateService.ViewState>
                                                        <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                                          <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                        </scg2:Dictionary>
                                                      </sap:WorkflowViewStateService.ViewState>
                                                      <gwa:Log sap:VirtualizedContainerService.HintSize="242,59" LogLevel="Debug" Message="merging featuresEnvelope with zoomEnvelope" />
                                                      <Assign sap:VirtualizedContainerService.HintSize="242,57">
                                                        <Assign.To>
                                                          <OutArgument x:TypeArguments="esri:Envelope">[zoomEnvelope]</OutArgument>
                                                        </Assign.To>
                                                        <Assign.Value>
                                                          <InArgument x:TypeArguments="esri:Envelope">[zoomEnvelope.Extent.Union(featuresEnvelope.Extent)]</InArgument>
                                                        </Assign.Value>
                                                      </Assign>
                                                    </Sequence>
                                                  </If.Else>
                                                </If>
                                              </FlowStep>
                                            </FlowStep.Next>
                                          </FlowStep>
                                        </FlowStep.Next>
                                      </FlowStep>
                                    </FlowDecision.True>
                                    <FlowDecision.False>
                                      <FlowStep x:Name="__ReferenceID12">
                                        <sap:WorkflowViewStateService.ViewState>
                                          <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                                            <av:Point x:Key="ShapeLocation">390,315.5</av:Point>
                                            <av:Size x:Key="ShapeSize">200,49</av:Size>
                                          </scg2:Dictionary>
                                        </sap:WorkflowViewStateService.ViewState>
                                        <gwa:Log sap:VirtualizedContainerService.HintSize="200,49" LogLevel="Debug" Message="No features returned from query" />
                                      </FlowStep>
                                    </FlowDecision.False>
                                  </FlowDecision>
                                </FlowStep.Next>
                              </FlowStep>
                            </FlowStep.Next>
                          </FlowStep>
                        </FlowStep.Next>
                      </FlowStep>
                    </Flowchart.StartNode>
                    <x:Reference>__ReferenceID10</x:Reference>
                    <FlowStep>
                      <sap:WorkflowViewStateService.ViewState>
                        <scg2:Dictionary x:TypeArguments="x:String, x:Object">
                          <av:Point x:Key="ShapeLocation">550,235.5</av:Point>
                          <av:Size x:Key="ShapeSize">200,49</av:Size>
                          <av:PointCollection x:Key="ConnectorLocation">300,278 300,302.5</av:PointCollection>
                        </scg2:Dictionary>
                      </sap:WorkflowViewStateService.ViewState>
                      <gwa:QueryTask sap:VirtualizedContainerService.HintSize="200,49" OutFields="*" QueryServiceUrl="[mapserviceUrl + &quot;/&quot; + layerId + &quot;/query&quot;]" Results="[featureSet]" ReturnGeometry="True" SpatialRelationship="esriSpatialRelIntersects" Where="[&quot;OBJECTID IN (&quot; + queryValues.ToString.Trim(New Char(){&quot;,&quot;c}) + &quot;)&quot;]" />
                    </FlowStep>
                    <x:Reference>__ReferenceID11</x:Reference>
                    <x:Reference>__ReferenceID12</x:Reference>
                    <x:Reference>__ReferenceID13</x:Reference>
                    <x:Reference>__ReferenceID14</x:Reference>
                    <x:Reference>__ReferenceID15</x:Reference>
                    <x:Reference>__ReferenceID16</x:Reference>
                    <x:Reference>__ReferenceID17</x:Reference>
                  </Flowchart>
                </If.Then>
              </If>
            </ActivityAction>
          </ForEach>
          <If Condition="[zoomEnvelope IsNot Nothing]" sap:VirtualizedContainerService.HintSize="494,201">
            <If.Then>
              <gwa:SetMapExtent Extent="[zoomEnvelope.Extent.Expand(1.1)]" sap:VirtualizedContainerService.HintSize="221,100" />
            </If.Then>
            <If.Else>
              <gwa:Log sap:VirtualizedContainerService.HintSize="231,100" LogLevel="Debug" Message="No features received from Tempest; map will not be zoomed." />
            </If.Else>
          </If>
          <gwa:DynamicExternal ExternalId="TempestSelectionsCompleted" sap:VirtualizedContainerService.HintSize="494,162">
            <gwa:DynamicExternal.InArguments>
              <gwa1:ArgumentWrapper x:TypeArguments="InArgument" IsRequired="False" Name="AllLayers">
                <gwa1:ArgumentWrapper.Argument>
                  <InArgument x:TypeArguments="scg2:List(x:String)">[tempestSession.AllTempestLayerNames]</InArgument>
                </gwa1:ArgumentWrapper.Argument>
              </gwa1:ArgumentWrapper>
            </gwa:DynamicExternal.InArguments>
          </gwa:DynamicExternal>
        </Sequence>
      </If.Else>
    </If>
  </Sequence>
</Activity>